<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title></title>

    <style type="text/css">

        body {
            background-color: gray;
        }

        canvas {
            border: 1px solid red;
            position: absolute; 
            top: 50%;
            left: 50%;
            margin-left: -430px; 
            margin-top: -300px;
        }
    </style>

    <script type="text/javascript">

        const urlImage = './penguins.jpg';
        let img, canvas, context, W, H;

        function desenare() {

            let iW = img.naturalWidth;
            let iH = img.naturalHeight;

            let f = Math.min(H/iH, W/iW);

            context.drawImage(img,
                0, 0, iW, iH,
                (W-f*iW)/2, (H-f*iH)/2, f * iW, f * iH);

            context.fillStyle = 'red';
            context.font = 'bold 14pt Tahoma';
            context.fillText(`(${mx}, ${my})`, 10, 20);

            context.beginPath();
            //context.arc(mx, my, 5, 0, 2 * Math.PI);
            context.fill();


            let imageData = context.getImageData(0, 0, W, H);
            let v = imageData.data;

            // for (let i = 0; i < v.length; i += 4) {
               // v[i] = 255; // R
                // v[i + 1] = 255; // G
                // v[i + 2] = 255; // B
                // v[i + 3] = 255; // transparenta (a)
            // }

            for (let y = 0; y < H; y++) {
                for (let x = 0; x < W; x++) {
                    let i = y*W*4 + x*4;

                    // dimensiune linie: W*4 elemente
                    // v = [0..W*4-1, W*4...2*W*4-1, ...]
                    //      y = 0     y = 1 ...
                    if (x ==  mx || y == my) {
                         v[i] = 255;
                         v[i + 1] = 0;
                         v[i + 2] = 0;

                    }

                    const raza = 100;
                    const d = Math.sqrt((x - mx) * (x - mx)
                        + (y-my)*(y-my)); // (x,y) <-> (mx, my)

                    if (d < raza) {
                        v[i + 3] = 255-(100 + d * 1.3);
                    } else {
                        v[i] = v[i + 1] = v[i + 2] =
                            (v[i] + v[i + 1] + v[i + 2]) / 3;

                        v[i + 3] = 10 + 100 * Math.random();
                    }


                   

                }
            }

            context.putImageData(imageData, 0, 0);
        }

        function aplicatie() {
            img = document.createElement('img');
            img.src = urlImage;
            img.addEventListener('load', e => {
                setInterval(desenare, 1000/30);
            });

            canvas = document.querySelector('canvas');
            context = canvas.getContext('2d');
            W = canvas.width;
            H = canvas.height;
        }


        let mx = 0, my = 0;
        function miscareMouse(e) {
            mx = Math.round(e.x - canvas.getBoundingClientRect().x);
            my = Math.round(e.y - canvas.getBoundingClientRect().y);
        }

        document.addEventListener('DOMContentLoaded', aplicatie);
        document.addEventListener('mousemove', miscareMouse);
    </script>

</head>
<body>
    <canvas width="860" height="600"></canvas>
</body>
</html>